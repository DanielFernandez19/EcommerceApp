(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[611],{17:(e,t,a)=>{Promise.resolve().then(a.bind(a,5090))},2488:(e,t,a)=>{"use strict";a.d(t,{AuthenticationProvider:()=>o,Z:()=>i});var r=a(5155),n=a(2115),s=a(5695);let c=(0,n.createContext)(void 0);function o(e){let{children:t}=e,[a,o]=(0,n.useState)(null),[i,l]=(0,n.useState)(!0),d=(0,s.useRouter)(),u=()=>{let e="; ".concat(document.cookie).split("; auth_token=");if(2===e.length){var t;return(null===(t=e.pop())||void 0===t?void 0:t.split(";").shift())||null}return null},h=()=>{let e="; ".concat(document.cookie).split("; auth_user=");if(2===e.length)try{var t;let a=null===(t=e.pop())||void 0===t?void 0:t.split(";").shift();if(a)return JSON.parse(decodeURIComponent(a))}catch(e){console.error("Error parsing auth_user cookie:",e)}return null};(0,n.useEffect)(()=>{(async()=>{try{if(u()){let e=h();e?o(e):(o(null),d.push("/Login"))}}catch(e){console.error("Error en inicializaci\xf3n:",e),o(null)}finally{l(!1)}})()},[]);let p=!!a,x=!!a&&[1,2].includes(a.idRole);return(0,r.jsx)(c.Provider,{value:{user:a,isAuthenticated:p,isAdmin:x,initializing:i,setUser:o,logout:()=>{document.cookie="auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="auth_user=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",localStorage.removeItem("auth"),o(null),d.push("/Login")},refreshAuth:()=>{if(u()){let e=h();e?o(e):(o(null),d.push("/Login"))}else o(null)}},children:t})}function i(){let e=(0,n.useContext)(c);if(void 0===e)throw Error("useAuthContext must be used within an AuthenticationProvider");return e}},5090:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var r=a(5155),n=a(2115),s=a(5695),c=a(2488),o=a(8316),i=a(5697);function l(){let{user:e}=(0,c.Z)(),t=(0,s.useRouter)(),[a,l]=(0,n.useState)([]),[d,u]=(0,n.useState)(!0),[h,p]=(0,n.useState)(null),[x,m]=(0,n.useState)(null);(0,n.useEffect)(()=>{if(!e){u(!1);return}if(![1,2].includes(e.idRole)){t.push("/dashboard");return}(async()=>{try{u(!0),p(null);let e=await (0,o.WF)();l(e||[])}catch(e){console.error("Error al cargar pedidos:",e),p("Error al cargar los pedidos. Por favor, intenta nuevamente.")}finally{u(!1)}})()},[e,t]);let y=e=>e?new Date(e).toLocaleDateString("es-AR",{day:"numeric",month:"long",year:"numeric"}):"Fecha no disponible",g=e=>{switch(e){case i.R.Pending:return{text:"Pendiente",color:"bg-yellow-600/20 text-yellow-400"};case i.R.Processing:return{text:"En proceso",color:"bg-blue-600/20 text-blue-400"};case i.R.Shipped:return{text:"Enviado",color:"bg-indigo-600/20 text-indigo-400"};case i.R.Delivered:return{text:"Entregado",color:"bg-green-600/20 text-green-400"};case i.R.Cancelled:return{text:"Cancelado",color:"bg-red-600/20 text-red-400"};default:return{text:"Desconocido",color:"bg-gray-600/20 text-gray-400"}}},f=e=>{let t=[];switch(e!==i.R.Cancelled&&t.push(i.R.Cancelled),e){case i.R.Pending:t.push(i.R.Processing);break;case i.R.Processing:t.push(i.R.Shipped);break;case i.R.Shipped:t.push(i.R.Delivered);case i.R.Delivered:case i.R.Cancelled:}return t},v=async(e,t)=>{if(x!==e)try{m(e),await (0,o.Kv)(e,t),l(a.map(a=>a.id===e?{...a,status:t}:a))}catch(e){console.error("Error al actualizar estado:",e),alert("Error al actualizar el estado del pedido. Por favor, intenta nuevamente.")}finally{m(null)}};return e?e&&[1,2].includes(e.idRole)?d?(0,r.jsx)("div",{className:"p-6 text-center",children:(0,r.jsx)("p",{className:"text-white",children:"Cargando pedidos..."})}):h?(0,r.jsxs)("div",{className:"p-6 text-center",children:[(0,r.jsx)("p",{className:"text-red-400 mb-4",children:h}),(0,r.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors",children:"Reintentar"})]}):(0,r.jsxs)("div",{className:"p-6 max-w-5xl mx-auto",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-white mb-6",children:"Gesti\xf3n de Pedidos"}),0===a.length?(0,r.jsx)("div",{className:"text-center py-12",children:(0,r.jsx)("p",{className:"text-gray-400 text-lg",children:"No hay pedidos"})}):(0,r.jsx)("div",{className:"space-y-4",children:a.map(e=>{let t=f(e.status),a=g(e.status);return(0,r.jsxs)("div",{className:"bg-gray-800 border border-gray-700 rounded-xl p-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"font-semibold text-white mb-1",children:["Pedido #",e.orderNumber]}),(0,r.jsxs)("p",{className:"text-sm text-gray-400",children:["Cliente: ",e.userName]}),(0,r.jsx)("p",{className:"text-sm text-gray-400",children:y(e.createdAt)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(a.color),children:a.text}),(0,r.jsxs)("select",{value:e.status,onChange:t=>v(e.id,parseInt(t.target.value)),disabled:x===e.id||0===t.length,className:"bg-gray-900 border border-gray-600 rounded-md text-white text-sm px-3 py-1 focus:outline-none focus:border-violet-500 disabled:opacity-50 disabled:cursor-not-allowed min-w-[150px]",children:[(0,r.jsxs)("option",{value:e.status,children:[a.text," (Actual)"]}),t.map(e=>{let t=g(e);return(0,r.jsx)("option",{value:e,children:t.text},e)})]}),x===e.id&&(0,r.jsx)("span",{className:"text-xs text-gray-400",children:"Actualizando..."})]})]}),(0,r.jsx)("div",{className:"space-y-3 mb-4",children:e.items&&e.items.length>0?e.items.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gray-700 rounded-lg"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-white font-medium",children:e.productName}),(0,r.jsxs)("p",{className:"text-sm text-gray-400",children:["Cantidad: ",e.quantity," \xd7 $",e.price.toLocaleString("es-AR")]})]}),(0,r.jsx)("div",{className:"text-right",children:(0,r.jsxs)("p",{className:"text-violet-400 font-semibold",children:["$",e.subtotal.toLocaleString("es-AR")]})})]},e.id)):(0,r.jsx)("p",{className:"text-gray-400 text-sm",children:"No hay items en este pedido"})}),(0,r.jsx)("div",{className:"flex justify-end items-center pt-4 border-t border-gray-700",children:(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-sm text-gray-400",children:"Total"}),(0,r.jsxs)("p",{className:"text-xl font-bold text-violet-400",children:["$",e.totalAmount.toLocaleString("es-AR")]})]})})]},e.id)})})]}):(0,r.jsxs)("div",{className:"p-6 text-center",children:[(0,r.jsx)("p",{className:"text-red-400",children:"No tienes permisos para acceder a esta p\xe1gina"}),(0,r.jsx)("p",{className:"text-gray-400 text-sm mt-2",children:"Solo administradores pueden ver esta p\xe1gina"})]}):(0,r.jsx)("div",{className:"p-6 text-center",children:(0,r.jsx)("p",{className:"text-gray-400",children:"Cargando..."})})}},5695:(e,t,a)=>{"use strict";var r=a(8999);a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}})},5697:(e,t,a)=>{"use strict";a.d(t,{R:()=>r});var r=function(e){return e[e.Pending=1]="Pending",e[e.Processing=2]="Processing",e[e.Shipped=3]="Shipped",e[e.Delivered=4]="Delivered",e[e.Cancelled=5]="Cancelled",e}({})},8316:(e,t,a)=>{"use strict";async function r(){try{let e=await fetch("".concat("http://localhost:5000/api","/products"));return e.ok?await e.json():[]}catch(e){return[]}}async function n(){try{let e=await fetch("".concat("http://localhost:5000/api","/order"));return e.ok?await e.json():[]}catch(e){return[]}}async function s(e){try{let t=await fetch("".concat("http://localhost:5000/api","/order/user/").concat(e));return t.ok?await t.json():[]}catch(e){return[]}}a.d(t,{DD:()=>h,Kv:()=>m,TK:()=>u,Us:()=>x,WF:()=>n,WY:()=>c,bW:()=>d,d$:()=>r,ht:()=>i,iG:()=>p,kg:()=>o,mq:()=>s,xw:()=>l});async function c(e){try{let t=await fetch("".concat("http://localhost:5000/api","/products"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return t.ok?await t.json():null}catch(e){return null}}async function o(e){try{return(await fetch("".concat("http://localhost:5000/api","/user/CreateUser"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok}catch(e){return!1}}async function i(e){try{let t=await fetch("".concat("http://localhost:5000/api","/user/GetAll"));if(!t.ok)return null;return(await t.json()).find(t=>t.email===e)}catch(e){return null}}async function l(e,t){try{return(await fetch("".concat("http://localhost:5000/api","/user/UpdatePass"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Id:e,newPassword:t})})).ok}catch(e){return!1}}async function d(){try{let e=await fetch("".concat("http://localhost:5000/api","/Products/GetCategories"));return e.ok?await e.json():[]}catch(e){return[]}}async function u(e,t){try{return(await fetch("".concat("http://localhost:5000/api","/user/UpdateUser"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok}catch(e){return!1}}async function h(e){try{return(await fetch("".concat("http://localhost:5000/api","/products/").concat(e),{method:"DELETE"})).ok}catch(e){return!1}}async function p(e,t){try{let a=new FormData;a.append("file",t);let r=await fetch("".concat("http://localhost:5000/api","/products/").concat(e,"/images"),{method:"POST",body:a});return r.ok?await r.json():null}catch(e){return null}}async function x(e){try{return(await fetch("".concat("http://localhost:5000/api","/products/images/").concat(e),{method:"DELETE"})).ok}catch(e){return!1}}async function m(e,t){try{return(await fetch("".concat("http://localhost:5000/api","/order/").concat(e,"/status"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})})).ok}catch(e){return!1}}}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(17)),_N_E=e.O()}]);