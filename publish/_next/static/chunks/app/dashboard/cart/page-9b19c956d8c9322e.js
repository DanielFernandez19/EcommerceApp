(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[776],{242:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var a=r(5155),s=r(2115),n=r(5695),o=r(3676),i=r(2488);function l(e){let{item:t}=e,[r,n]=(0,s.useState)(t.quantity),[l,c]=(0,s.useState)(!1),{removeItem:d,updateQuantity:u}=(0,o.x)(),{user:h}=(0,i.Z)();(0,s.useEffect)(()=>{n(t.quantity)},[t.quantity]);let x=async e=>{if(h&&!l){if(e<1){n(1);return}n(e),c(!0);try{await u(h.id,t.id,e)}catch(e){console.error("Error al actualizar cantidad:",e),n(t.quantity)}finally{c(!1)}}},m=(t.price*r).toLocaleString("es-AR");return(0,a.jsx)("div",{className:"bg-gray-800 border border-gray-700 rounded-xl p-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-semibold text-white mb-2",children:t.productName}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-sm text-gray-400",children:"Cantidad:"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>{r>1&&x(r-1)},disabled:r<=1||l,className:"w-8 h-8 rounded-md flex items-center justify-center transition-colors ".concat(r<=1||l?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-gray-700 text-white hover:bg-gray-600"),children:"âˆ’"}),(0,a.jsx)("input",{type:"number",min:"1",value:r,onChange:e=>{let r=e.target.value;if(""===r)n(1);else{let e=parseInt(r);!isNaN(e)&&e>0?n(e):n(t.quantity)}},onBlur:()=>{let e=r<1?1:r;e!==r&&n(e),e!==t.quantity&&h&&x(e)},onKeyDown:e=>{"Enter"===e.key&&e.currentTarget.blur()},disabled:l,className:"w-16 h-8 text-center bg-gray-900 border border-gray-600 rounded-md text-white text-sm focus:outline-none focus:border-violet-500 disabled:opacity-50 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"}),(0,a.jsx)("button",{onClick:()=>{x(r+1)},disabled:l,className:"w-8 h-8 rounded-md flex items-center justify-center transition-colors ".concat(l?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-gray-700 text-white hover:bg-gray-600"),children:"+"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Precio unitario:"}),(0,a.jsxs)("p",{className:"text-violet-400 font-semibold",children:["$",t.price.toLocaleString("es-AR")]}),(0,a.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"Subtotal:"}),(0,a.jsxs)("p",{className:"text-violet-400 font-bold text-lg",children:["$",m]})]}),(0,a.jsx)("button",{onClick:()=>{h&&d(h.id,t.id)},className:"text-red-400 hover:text-red-300 transition-colors p-2",title:"Eliminar del carrito",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})})}var c=r(3024);function d(e){let{cart:t}=e,r=(0,n.useRouter)(),{user:l}=(0,i.Z)(),{loadCart:d}=(0,o.x)(),[u,h]=(0,s.useState)(!1);if(!t||!t.items)return null;let x=t.items.length,m=t.items.reduce((e,t)=>e+t.price*t.quantity,0),p=t.total||m,f=async()=>{if(l&&!u)try{h(!0),await (0,c.Jn)(l.id),await d(l.id),r.push("/orders")}catch(e){console.error("Error al confirmar pedido:",e),alert(e instanceof Error?e.message:"Error al confirmar el pedido. Por favor, intenta nuevamente.")}finally{h(!1)}};return(0,a.jsxs)("div",{className:"bg-gray-800 border border-gray-700 rounded-xl p-6 space-y-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Resumen"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm text-gray-300",children:[(0,a.jsx)("span",{children:"Productos:"}),(0,a.jsx)("span",{className:"font-semibold text-white",children:x})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm text-gray-300",children:[(0,a.jsx)("span",{children:"Subtotal:"}),(0,a.jsxs)("span",{className:"font-semibold text-white",children:["$",m.toLocaleString("es-AR")]})]}),(0,a.jsx)("div",{className:"border-t border-gray-700 pt-3",children:(0,a.jsxs)("div",{className:"flex justify-between text-base",children:[(0,a.jsx)("span",{className:"font-semibold text-white",children:"Total:"}),(0,a.jsxs)("span",{className:"font-bold text-violet-400",children:["$",p.toLocaleString("es-AR")]})]})})]}),(0,a.jsx)("button",{onClick:f,disabled:u||!l||0===x,className:"w-full py-2 rounded-lg font-semibold text-white transition-colors ".concat(u||!l||0===x?"bg-gray-700 text-gray-400 cursor-not-allowed":"bg-violet-600 hover:bg-violet-700"),children:u?"Procesando...":"Confirmar pedido"})]})}function u(){let{cart:e,loadCart:t,loading:r}=(0,o.x)(),{user:c}=(0,i.Z)(),u=(0,n.useRouter)();return((0,s.useEffect)(()=>{c&&t(c.id)},[c,t]),r)?(0,a.jsx)("div",{className:"p-6 text-center",children:(0,a.jsx)("p",{className:"text-white",children:"Cargando carrito..."})}):e&&0!==e.items.length?(0,a.jsxs)("div",{className:"p-6 max-w-5xl mx-auto",children:[(0,a.jsxs)("button",{onClick:()=>u.push("/"),className:"mb-6 flex items-center gap-2 text-violet-400 hover:text-violet-300 transition-colors",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Volver"]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"col-span-2 space-y-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-white",children:"Carrito"}),e.items.map(e=>(0,a.jsx)(l,{item:e},e.id))]}),(0,a.jsx)(d,{cart:e})]})]}):(0,a.jsxs)("div",{className:"p-6 max-w-5xl mx-auto",children:[(0,a.jsxs)("button",{onClick:()=>u.push("/"),className:"mb-6 flex items-center gap-2 text-violet-400 hover:text-violet-300 transition-colors",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Volver"]}),(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-gray-400 text-lg",children:"Tu carrito est\xe1 vac\xedo"})})]})}},2488:(e,t,r)=>{"use strict";r.d(t,{AuthenticationProvider:()=>i,Z:()=>l});var a=r(5155),s=r(2115),n=r(5695);let o=(0,s.createContext)(void 0);function i(e){let{children:t}=e,[r,i]=(0,s.useState)(null),[l,c]=(0,s.useState)(!0),d=(0,n.useRouter)(),u=()=>{let e="; ".concat(document.cookie).split("; auth_token=");if(2===e.length){var t;return(null===(t=e.pop())||void 0===t?void 0:t.split(";").shift())||null}return null},h=()=>{let e="; ".concat(document.cookie).split("; auth_user=");if(2===e.length)try{var t;let r=null===(t=e.pop())||void 0===t?void 0:t.split(";").shift();if(r)return JSON.parse(decodeURIComponent(r))}catch(e){console.error("Error parsing auth_user cookie:",e)}return null};(0,s.useEffect)(()=>{(async()=>{try{if(u()){let e=h();e?i(e):(i(null),d.push("/Login"))}}catch(e){console.error("Error en inicializaci\xf3n:",e),i(null)}finally{c(!1)}})()},[]);let x=!!r,m=!!r&&[1,2].includes(r.idRole);return(0,a.jsx)(o.Provider,{value:{user:r,isAuthenticated:x,isAdmin:m,initializing:l,setUser:i,logout:()=>{document.cookie="auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="auth_user=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",localStorage.removeItem("auth"),i(null),d.push("/Login")},refreshAuth:()=>{if(u()){let e=h();e?i(e):(i(null),d.push("/Login"))}else i(null)}},children:t})}function l(){let e=(0,s.useContext)(o);if(void 0===e)throw Error("useAuthContext must be used within an AuthenticationProvider");return e}},3024:(e,t,r)=>{"use strict";r.d(t,{AR:()=>i,Jn:()=>l,Mr:()=>n,SM:()=>o,Xl:()=>s});let a="http://localhost:5000/api";async function s(e){let t=await fetch("".concat(a,"/Cart/GetCart/").concat(e),{cache:"no-store"});if(!t.ok)throw Error("Error al obtener carrito");return t.json()}async function n(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=await fetch("".concat(a,"/Cart/AddItemToCart"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,productId:t,quantity:r})});if(console.log("AddItem payload:",{userId:e,productId:t,quantity:r}),!s.ok)throw Error("Error al agregar producto");return s.json()}async function o(e){if(!(await fetch("".concat(a,"/Cart/RemoveCartItem/").concat(e),{method:"DELETE"})).ok)throw Error("Error al eliminar item")}async function i(e,t){let r=await fetch("".concat(a,"/Cart/UpdateCartItemQuantity/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw Error("Error al actualizar cantidad");return r.json()}async function l(e){let t=await fetch("".concat(a,"/Order/CreateOrder"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e})});if(!t.ok)throw Error((await t.json().catch(()=>({}))).message||"Error al confirmar pedido");return t.json()}},3676:(e,t,r)=>{"use strict";r.d(t,{x:()=>c});var a=r(2115);let s=e=>{let t;let r=new Set,a=(e,a)=>{let s="function"==typeof e?e(t):e;if(!Object.is(s,t)){let e=t;t=(null!=a?a:"object"!=typeof s||null===s)?s:Object.assign({},t,s),r.forEach(r=>r(t,e))}},s=()=>t,n={setState:a,getState:s,getInitialState:()=>o,subscribe:e=>(r.add(e),()=>r.delete(e))},o=t=e(a,s,n);return n},n=e=>e?s(e):s,o=e=>e,i=e=>{let t=n(e),r=e=>(function(e,t=o){let r=a.useSyncExternalStore(e.subscribe,a.useCallback(()=>t(e.getState()),[e,t]),a.useCallback(()=>t(e.getInitialState()),[e,t]));return a.useDebugValue(r),r})(t,e);return Object.assign(r,t),r};var l=r(3024);let c=(e=>e?i(e):i)(e=>({cart:null,loading:!1,loadCart:async t=>{e({loading:!0}),e({cart:await (0,l.Xl)(t),loading:!1})},addProduct:async(t,r)=>{await (0,l.Mr)(t,r,1),e({cart:await (0,l.Xl)(t)})},removeItem:async(t,r)=>{await (0,l.SM)(r),e({cart:await (0,l.Xl)(t)})},updateQuantity:async(t,r,a)=>{!(a<1)&&(await (0,l.AR)(r,a),e({cart:await (0,l.Xl)(t)}))}}))},5695:(e,t,r)=>{"use strict";var a=r(8999);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})},9942:(e,t,r)=>{Promise.resolve().then(r.bind(r,242))}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(9942)),_N_E=e.O()}]);