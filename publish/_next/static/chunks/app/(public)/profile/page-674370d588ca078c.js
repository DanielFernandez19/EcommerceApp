(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[517],{1313:(e,r,t)=>{Promise.resolve().then(t.bind(t,7302))},2037:(e,r,t)=>{"use strict";t.d(r,{j:()=>o});var a=t(5155);function o(e){let{message:r}=e;return(0,a.jsx)("div",{className:"bg-green-900/50 border border-green-700 text-green-300 px-6 py-4 rounded-lg shadow-lg",role:"alert",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("svg",{className:"h-6 w-6 text-green-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,a.jsx)("div",{className:"ml-3",children:(0,a.jsx)("p",{className:"font-medium",children:r})})]})})}},2488:(e,r,t)=>{"use strict";t.d(r,{AuthenticationProvider:()=>n,Z:()=>i});var a=t(5155),o=t(2115),s=t(5695);let l=(0,o.createContext)(void 0);function n(e){let{children:r}=e,[t,n]=(0,o.useState)(null),[i,u]=(0,o.useState)(!0),c=(0,s.useRouter)(),d=()=>{let e="; ".concat(document.cookie).split("; auth_token=");if(2===e.length){var r;return(null===(r=e.pop())||void 0===r?void 0:r.split(";").shift())||null}return null},h=()=>{let e="; ".concat(document.cookie).split("; auth_user=");if(2===e.length)try{var r;let t=null===(r=e.pop())||void 0===r?void 0:r.split(";").shift();if(t)return JSON.parse(decodeURIComponent(t))}catch(e){console.error("Error parsing auth_user cookie:",e)}return null};(0,o.useEffect)(()=>{(async()=>{try{if(d()){let e=h();e?n(e):(n(null),c.push("/Login"))}}catch(e){console.error("Error en inicializaci\xf3n:",e),n(null)}finally{u(!1)}})()},[]);let m=!!t,v=!!t&&[1,2].includes(t.idRole);return(0,a.jsx)(l.Provider,{value:{user:t,isAuthenticated:m,isAdmin:v,initializing:i,setUser:n,logout:()=>{document.cookie="auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="auth_user=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",localStorage.removeItem("auth"),n(null),c.push("/Login")},refreshAuth:()=>{if(d()){let e=h();e?n(e):(n(null),c.push("/Login"))}else n(null)}},children:r})}function i(){let e=(0,o.useContext)(l);if(void 0===e)throw Error("useAuthContext must be used within an AuthenticationProvider");return e}},7302:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>h});var a=t(5155),o=t(2115),s=t(5695),l=t(8316),n=t(2488),i=t(8567),u=t(2037),c=t(5731);function d(e){var r;let{userId:t,title:d="Editar Perfil",onSuccess:h,onCancel:m}=e,v=(0,s.useRouter)(),{user:x}=(0,n.Z)(),[f,g]=(0,o.useState)(!1),[p,b]=(0,o.useState)(!0),[j,N]=(0,o.useState)(null),[y,E]=(0,o.useState)(!1),w=async()=>{try{console.log("\uD83D\uDD04 INICIO loadUser - userId:",t,"currentUser:",null==x?void 0:x.id),b(!0);let e=t||(null==x?void 0:x.id);if(e){console.log("\uD83D\uDCE1 Llamando a la API con ID:",e);let r=await c.uE.get("user/GetUserById/".concat(e));console.log("✅ Datos del usuario cargados:",r),N(r)}else console.log("⚠️ No hay userId ni currentUser")}catch(e){console.error("❌ Error loading data:",e),e instanceof Error?e.message.includes("NetworkError")||e.message.includes("fetch")?alert("Error de conexi\xf3n: No se puede conectar con el servidor. Por favor, verifica que el backend est\xe9 corriendo en http://localhost:5024"):e.message.includes("404")?alert("Error: Usuario no encontrado. Por favor, intenta nuevamente."):alert("Error al cargar los datos del usuario: ".concat(e.message)):alert("Error al cargar los datos del usuario. Por favor, intenta nuevamente.")}finally{console.log("\uD83C\uDFC1 FIN loadUser - fetchLoading:",!1),b(!1)}};(0,o.useEffect)(()=>{let e=t||(null==x?void 0:x.id);e&&!j?w():e||b(!1)},[t,null==x?void 0:x.id]);let k=async e=>{g(!0);try{if("object"==typeof e&&null!==e&&"name"in e){if(await (0,l.TK)(j.id,e))null==h||h(),E(!0),setTimeout(()=>{E(!1)},3e3),t&&v.push("/dashboard");else throw Error("No se pudo actualizar el usuario")}else throw Error("Datos de usuario inv\xe1lidos")}catch(e){alert("Error al actualizar el usuario. Por favor, intenta nuevamente.")}finally{g(!1)}};return p||!j?(0,a.jsx)("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 border-2 border-violet-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-400",children:"Cargando datos..."})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-900 py-8 ",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto mt-6 px-4",children:[y&&(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(u.j,{message:"\xa1Perfil actualizado exitosamente!"})}),(0,a.jsx)("div",{className:"bg-gray-800 rounded-xl border border-gray-700",children:(0,a.jsx)(i.p,{user:j,loading:f,onSubmit:k,onCancel:()=>{m?m():v.push("/dashboard")},title:d,subtitle:t?"Edita la informaci\xf3n del usuario":"Edita tu informaci\xf3n personal",submitText:"Guardar Cambios",cancelText:m?"Cancelar":"Volver al dashboard",showRoleSelector:!1,children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-white mb-6",children:"Tu Rol"}),(0,a.jsx)("div",{className:"bg-gray-700 p-4 rounded-lg",children:(0,a.jsxs)("span",{className:"text-gray-300",children:["Rol actual:"," ",(0,a.jsx)("span",{className:"text-violet-400 font-medium",children:(null===(r=j.role)||void 0===r?void 0:r.name)||"User"})]})})]})})})]})})}function h(){let e=(0,s.useRouter)();return(0,a.jsx)(d,{onSuccess:()=>{},onCancel:()=>{e.push("/dashboard")}})}}},e=>{var r=r=>e(e.s=r);e.O(0,[561,710,441,684,358],()=>r(1313)),_N_E=e.O()}]);