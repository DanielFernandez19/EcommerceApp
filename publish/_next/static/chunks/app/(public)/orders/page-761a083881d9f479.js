(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[353],{1546:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>l});var a=n(5155),r=n(2115),o=n(5695),s=n(2488),c=n(8316),i=n(5697);function l(){let{user:t}=(0,s.Z)(),e=(0,o.useRouter)(),[n,l]=(0,r.useState)([]),[d,u]=(0,r.useState)(!0),[h,p]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{if(!t){u(!1);return}try{u(!0),p(null);let e=await (0,c.mq)(t.id);l(e)}catch(t){console.error("Error al cargar pedidos:",t),p("Error al cargar los pedidos. Por favor, intenta nuevamente.")}finally{u(!1)}})()},[t]);let x=t=>t?new Date(t).toLocaleDateString("es-AR",{day:"numeric",month:"long",year:"numeric"}):"Fecha no disponible",m=t=>{switch(t){case i.R.Pending:return{text:"Pendiente",color:"bg-yellow-600/20 text-yellow-400"};case i.R.Processing:return{text:"En proceso",color:"bg-blue-600/20 text-blue-400"};case i.R.Shipped:return{text:"Enviado",color:"bg-indigo-600/20 text-indigo-400"};case i.R.Delivered:return{text:"Entregado",color:"bg-green-600/20 text-green-400"};case i.R.Cancelled:return{text:"Cancelado",color:"bg-red-600/20 text-red-400"};default:return{text:"Desconocido",color:"bg-gray-600/20 text-gray-400"}}};return t?d?(0,a.jsx)("div",{className:"pt-10 p-6 text-center",children:(0,a.jsx)("p",{className:"text-white",children:"Cargando pedidos..."})}):h?(0,a.jsxs)("div",{className:"pt-10 p-6 text-center",children:[(0,a.jsx)("p",{className:"text-red-400 mb-4",children:h}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors",children:"Reintentar"})]}):(0,a.jsxs)("div",{className:"pt-10 p-6 max-w-5xl mx-auto",children:[(0,a.jsxs)("button",{onClick:()=>e.push("/"),className:"mb-6 flex items-center gap-2 text-violet-400 hover:text-violet-300 transition-colors",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Volver"]}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-white mb-6",children:"Mis Pedidos"}),0===n.length?(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-gray-400 text-lg",children:"No tienes pedidos a\xfan"})}):(0,a.jsx)("div",{className:"space-y-4",children:n.map(t=>(0,a.jsxs)("div",{className:"bg-gray-800 border border-gray-700 rounded-xl p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-semibold text-white mb-1",children:["Pedido #",t.orderNumber]}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:x(t.createdAt)})]}),(0,a.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(m(t.status).color),children:m(t.status).text})]}),(0,a.jsx)("div",{className:"space-y-3 mb-4",children:t.items&&t.items.length>0?t.items.map(t=>(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gray-700 rounded-lg"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-white font-medium",children:t.productName}),(0,a.jsxs)("p",{className:"text-sm text-gray-400",children:["Cantidad: ",t.quantity," \xd7 $",t.price.toLocaleString("es-AR")]})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsxs)("p",{className:"text-violet-400 font-semibold",children:["$",t.subtotal.toLocaleString("es-AR")]})})]},t.id)):(0,a.jsx)("p",{className:"text-gray-400 text-sm",children:"No hay items en este pedido"})}),(0,a.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t border-gray-700",children:[(0,a.jsx)("button",{className:"px-4 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors text-sm",children:"Comprar nuevamente"}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Total"}),(0,a.jsxs)("p",{className:"text-xl font-bold text-violet-400",children:["$",t.totalAmount.toLocaleString("es-AR")]})]})]})]},t.id))})]}):(0,a.jsx)("div",{className:"pt-10 p-6 text-center",children:(0,a.jsx)("p",{className:"text-gray-400",children:"Debes iniciar sesi\xf3n para ver tus pedidos"})})}},2488:(t,e,n)=>{"use strict";n.d(e,{AuthenticationProvider:()=>c,Z:()=>i});var a=n(5155),r=n(2115),o=n(5695);let s=(0,r.createContext)(void 0);function c(t){let{children:e}=t,[n,c]=(0,r.useState)(null),[i,l]=(0,r.useState)(!0),d=(0,o.useRouter)(),u=()=>{let t="; ".concat(document.cookie).split("; auth_token=");if(2===t.length){var e;return(null===(e=t.pop())||void 0===e?void 0:e.split(";").shift())||null}return null},h=()=>{let t="; ".concat(document.cookie).split("; auth_user=");if(2===t.length)try{var e;let n=null===(e=t.pop())||void 0===e?void 0:e.split(";").shift();if(n)return JSON.parse(decodeURIComponent(n))}catch(t){console.error("Error parsing auth_user cookie:",t)}return null};(0,r.useEffect)(()=>{(async()=>{try{if(u()){let t=h();t?c(t):(c(null),d.push("/Login"))}}catch(t){console.error("Error en inicializaci\xf3n:",t),c(null)}finally{l(!1)}})()},[]);let p=!!n,x=!!n&&[1,2].includes(n.idRole);return(0,a.jsx)(s.Provider,{value:{user:n,isAuthenticated:p,isAdmin:x,initializing:i,setUser:c,logout:()=>{document.cookie="auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="auth_user=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",localStorage.removeItem("auth"),c(null),d.push("/Login")},refreshAuth:()=>{if(u()){let t=h();t?c(t):(c(null),d.push("/Login"))}else c(null)}},children:e})}function i(){let t=(0,r.useContext)(s);if(void 0===t)throw Error("useAuthContext must be used within an AuthenticationProvider");return t}},5663:(t,e,n)=>{Promise.resolve().then(n.bind(n,1546))},5695:(t,e,n)=>{"use strict";var a=n(8999);n.o(a,"usePathname")&&n.d(e,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(e,{useRouter:function(){return a.useRouter}})},5697:(t,e,n)=>{"use strict";n.d(e,{R:()=>a});var a=function(t){return t[t.Pending=1]="Pending",t[t.Processing=2]="Processing",t[t.Shipped=3]="Shipped",t[t.Delivered=4]="Delivered",t[t.Cancelled=5]="Cancelled",t}({})},8316:(t,e,n)=>{"use strict";async function a(){try{let t=await fetch("".concat("http://localhost:5000/api","/products"));return t.ok?await t.json():[]}catch(t){return[]}}async function r(){try{let t=await fetch("".concat("http://localhost:5000/api","/order"));return t.ok?await t.json():[]}catch(t){return[]}}async function o(t){try{let e=await fetch("".concat("http://localhost:5000/api","/order/user/").concat(t));return e.ok?await e.json():[]}catch(t){return[]}}n.d(e,{DD:()=>h,Kv:()=>m,TK:()=>u,Us:()=>x,WF:()=>r,WY:()=>s,bW:()=>d,d$:()=>a,ht:()=>i,iG:()=>p,kg:()=>c,mq:()=>o,xw:()=>l});async function s(t){try{let e=await fetch("".concat("http://localhost:5000/api","/products"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return e.ok?await e.json():null}catch(t){return null}}async function c(t){try{return(await fetch("".concat("http://localhost:5000/api","/user/CreateUser"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok}catch(t){return!1}}async function i(t){try{let e=await fetch("".concat("http://localhost:5000/api","/user/GetAll"));if(!e.ok)return null;return(await e.json()).find(e=>e.email===t)}catch(t){return null}}async function l(t,e){try{return(await fetch("".concat("http://localhost:5000/api","/user/UpdatePass"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({Id:t,newPassword:e})})).ok}catch(t){return!1}}async function d(){try{let t=await fetch("".concat("http://localhost:5000/api","/Products/GetCategories"));return t.ok?await t.json():[]}catch(t){return[]}}async function u(t,e){try{return(await fetch("".concat("http://localhost:5000/api","/user/UpdateUser"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok}catch(t){return!1}}async function h(t){try{return(await fetch("".concat("http://localhost:5000/api","/products/").concat(t),{method:"DELETE"})).ok}catch(t){return!1}}async function p(t,e){try{let n=new FormData;n.append("file",e);let a=await fetch("".concat("http://localhost:5000/api","/products/").concat(t,"/images"),{method:"POST",body:n});return a.ok?await a.json():null}catch(t){return null}}async function x(t){try{return(await fetch("".concat("http://localhost:5000/api","/products/images/").concat(t),{method:"DELETE"})).ok}catch(t){return!1}}async function m(t,e){try{return(await fetch("".concat("http://localhost:5000/api","/order/").concat(t,"/status"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:e})})).ok}catch(t){return!1}}}},t=>{var e=e=>t(t.s=e);t.O(0,[441,684,358],()=>e(5663)),_N_E=t.O()}]);